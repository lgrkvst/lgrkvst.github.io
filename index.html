<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-tap-highlight" content="no">
<meta name="description" content="Continuous Delivery Home">
<title>Curriculum Vitae &mdash; Christian Lagerkvist</title>
<link rel="stylesheet" href="materialize/css/materialize.css">
<link rel="stylesheet" href="css/greenfield.css">
<link rel="stylesheet" href="css/chart.css">
</head>

<body>
<section class="main">
<div class="container">
<div class="row">
<div class="col s7 heroheader">
<h2>
			<div class="outdent">curriculum vitae</div>
			VISUALISED
		</h2>
<!-- <h5 class="byline">Christian Lagerkvist</h5>
 --></div>
</div>
</div>
<div class="row">
<!-- Switch -->
<!-- <div class="switch right">
<label>
time
<input type="checkbox" onchange="javascript:toggle();">
<span class="lever light-green lighten-4"></span> geo
</label>
</div>
 -->
<svg width="900" height="400">
<defs>
<linearGradient id="lgrad" x1="50%" y1="100%" x2="50%" y2="0%">
<stop offset="0%" style="stop-color:rgb(152,152,152);stop-opacity:1" />
<stop offset="6%" style="stop-color:rgb(113,113,113);stop-opacity:1" />
<stop offset="49%" style="stop-color:rgb(81,81,81);stop-opacity:1" />
<stop offset="50%" style="stop-color:rgb(33,33,33);stop-opacity:1" />
<stop offset="90%" style="stop-color:rgb(83,83,83);stop-opacity:1" />
<stop offset="100%" style="stop-color:rgb(152,152,152);stop-opacity:1" />
</linearGradient>
<filter id="dropshadow" height="200%">
<feGaussianBlur in="SourceAlpha" stdDeviation="2" />
<!-- stdDeviation is how much to blur -->
<feOffset dx="0" dy="0" result="offsetblur" />
<!-- how much to offset -->
<feMerge>
<feMergeNode/>
<!-- this contains the offset blurred image -->
<feMergeNode in="SourceGraphic" />
<!-- this contains the element that the filter is applied to -->
</feMerge>
</filter>
<linearGradient id="yearline" x1="50%" y1="100%" x2="50%" y2="0%">
<stop offset="0%" style="stop-color:#000;stop-opacity:0" />
<stop offset="50%" style="stop-color:#000;stop-opacity:0.2" />
<stop offset="100%" style="stop-color:#000;stop-opacity:0" />
</linearGradient>
</defs>
</svg>
</div>
</section>
<section>



<div class="container">
<div class="row">
<div class="col s7 heroheader">
<h1>
   <div class="outdent">några axplock</div>
        </h1>
</div>
<div class="row slab">
    <div class="col s6">
    <p>
        <h5>Textcenter AB</h5>
        <ul class="browser-default">
        <li>Kursansvarig på Stockholm Universitets 5-poängskurs i Datorgrafik</li>
        <li>Etablerar kontor i Uppsala med ansvar för försäljning och marknadsföring av webbtjänsten Reply PDF. Tar fram och genomför marknadsplan samt etablerar säljkanaler.</li>
        </ul>
    </p>

    <p>
        <h5>Bytewize AB</h5> tillhandahåller IT-support, webbhosting, nätverksdrift samt en rad webblösningar.
        <ul class="browser-default">
        <li>Ansar i en »sönderutvecklad« produkt- och tjänstematris.</li>
        <li>Formulerar och fokuserar verksamheten i att agera värdeskapande.</li>
        </ul>
    </p>

    <p>
    <h5>Nordic Touch AB</h5> är agent för den italienska glassen <strong>Bruno Gelato</strong> som säljs i dagligvaruhandeln.
    <ul class="browser-default">
<li>Genomför målgruppsanalyser, marknadsundersökningar, planerar marknadsaktiviteter och styr bolagets övergripande affärsutvecklingsprocess.</li>
<li>Handleder ytterligare fyra praktikanter från sälj- och marknadsföringsprogrammet samt universitetets civilekonomprogram.</li>
<li>Tar fram nya produktprofiler, varumärken samt marknadsplaner för en rad produkter.</li>
<li>Fokuserar om verksamheten för att verka långsiktigt värdebildande, baserat på egna varumärken och redundans i leverantörsleden.</li>
<li>Scoutar nya leverantörer på kontinenten</li>
<li>Kläcker, utformar och genomför gerillakampanjen »Glassval 2006« som hamnar i rikstäckande television.</li>
<li>Ökar omsättningen med 70% genom att etablera nya säljkanaler samt avveckla restaurangsidan för att kunna fokusera på butikssidan.</li>
</ul>
</p>
<p>
<h5>Spherofix AB</h5> är ett nystartat tillväxtföretag som kretsar kring en mekanisk innovation.
<ul class="browser-default">
<li>Tar fram företagets affärsplan, tillsammans med en marknadsplan för affärsområdet ortopedi.</li>
<li>Kartlägger och säkrar intellektuella rättigheter.</li>
<li>»Tvättar« affärsidén i UIC Business Lab (företagsinkubator).</li>
<li>Anskaffar riskkapital, mjuk- och hård finansiering.</li>
</ul>
</p>

<p>
<h5>CONNECT</h5> är ett internationellt nätverk som väver samman entreprenörer med kompetens och kapital.
<ul class="browser-default">
<li>Agerar scout och mentor för entreprenörer som vill förverkliga sina affärsidéer.</li>
<li>Planerar och genomför s k »språngbrädor«, där entreprenören presenterar sin affärsidé för en expertpanel bestående av 5-10 personer verksamma inom Uppsalas näringsliv.</li>
<li>Tar initiativ till samt genomför CONNECTs första »tjejsprångis«, där panelen uteslutande utgörs av kvinnor.</li>
<li>Bygger upp ett gediget nätverk i Uppsala och Stockholm bestående av affärsjurister, revisorer, banktjänstemän, entreprenörer och aktörer i innovationssystemet.</li>
</ul>
</p>
    </div>
    <div class="col s6">
<p>
<h5>Skandinaviska Enskilda Banken AB (publ)</h5>
<ul class="browser-default">
<li>Agerar SAA (Solution Area Architect) inom ECM, med fokus att sänka kostnader och komplexitet via strategiska IT-satsningar. Ansvarar för ett 45-tal system.</li>
<li>Skapar <a href="https://github.com/lgrkvst/visarch">Observatoriet</a>, en <a href="https://rawgit.com/lgrkvst/d3-sunburst-menu/master/demo/d3-sunburst-demo.html">javascript-applikation</a> för att visualisera hur bankens 1300 IT-system hänger ihop.</li>
<li>Pionjerar bankens <strong>Innovation Lab</strong> med egna bidrag:
    <ul class="browser-default">
        <li>Dashboard för att visualisera bankens försäljningar på kontor i realtid, och samtidigt undvika den dyra BigData-vägen.</li>
        <li>Startar, som tidig Ethereumpionjär, <strong>Blockchain Academy</strong> &mdash; ett initiativ för att under 2015 få upp banken på tårna i blockkedjefrågan. Internt samt LargeCorp-segmentet.</li>
        <li><strong>Disrupt the Business</strong> &mdash; om vi vore en startup i färd med att disrupta vår Card-division, hur skulle vi gå tillväga? Resultatet föredrogs för Card-ledningen med gott resultat.</li>
    </ul>
</li>
<li>Personlig inbjudan från Annika Falkengren för att demonstrera innovationer för SEB:s styrelse.
</li>
<li>Representerar SEB i blockkedjestartupen <strong>R3-CEV</strong>, samt håller kontakt med leverantörer inom blockkedjevärlden. Bygger en rad proof-of-concepts baserade på <a href="https://www.ethereum.org/">Ethereum</a>.
</li>
<li>
<strong>Artificiell Intelligens</strong> &mdash; Projektleder bankens <a href="https://www.ibm.com/watson/">IBM Watson</a>-initiativ inom området Wealth Management.
</li>
<li>Projektleder bankens deltagande i <a href="http://productive40.eu/">Productive 4.0</a>, EU:s största projekt (till antalet deltagare) för att digitalisera Europeisk industri och öka konkurrenskraften gentemot USA och Kina.
</li>
<li>Startar på eget initiativ en utredning för att etablera en <strong>kryptobörs</strong>, och därigenom låta bankens varumärke agera brygga då hedgefonder, alternativplacerare samt nästa industrivåg ger sig in i blockkedjevärlden.
</li>
<li>Tar fram en prototyp för »morgondagens spara-produkt« genom att satsa på gamification istället för den konventionella AI-approachen</li>
</ul>
</p>        

    <div class="card horizontal">
      <div class="card-image">
        <img src="https://avatars0.githubusercontent.com/u/4451499?v=4&s=460">
      </div>
      <div class="card-stacked">
        <div class="card-content">
        <h5>I övrigt</h5>
          <p>Svenska och engelska utmärkt i tal och skrift. Tyska bra i tal. B-körkort.</p>
        </div>
        <div class="card-action">
              <a href="https://github.com/lgrkvst">github</a>
              <a href="https://www.linkedin.com/in/christian-lagerkvist-b161053/">linkedin</a>
              <a href="https://onename.com/cla">onename</a>
        </div>
      </div>
    </div>


    </div>
</div>
</div>



</section>
</body>
<script src="js/lib/d3.min.js"></script>
<script src="js/lib/d3-shape.js"></script>
<script src="js/lib/d3-scale-chromatic.v1.min.js"></script>
<script src="js/lib/least-squares.js"></script>
<script src="js/lib/textwrap.js"></script>
<script src="js/lib/d3-bboxCollide.min.js"></script>
<script src="js/lib/dat.gui.min.js"></script>



<script>
var svg = d3.select("svg");
var bodyrect = d3.select("body").node().getBoundingClientRect();
svg.attr("width", bodyrect.width);

var margin = {
        top: 100,
        right: 0,
        bottom: 100,
        left: 0
    },
    margin2 = {
        top: 0,
        right: 0,
        bottom: 380,
        left: 0
    },
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    width2 = +svg.attr("width") - margin2.left - margin2.right,
    height2 = +svg.attr("height") - margin2.top - margin2.bottom;

var x = d3.scaleTime().range([0, width]),
    x2 = d3.scaleTime().range([0, width2]),
    x2_to_x = d3.scaleLinear().range([0, width]),
    y = d3.scaleLinear().range([height, 0]),
    y2 = d3.scaleLinear().range([height2, 0]);

var startRange = [81, width2];

var xAxis = d3.axisBottom(x),
    xAxis2 = d3.axisTop(x2),
    yAxis = d3.axisRight(y).ticks(4).tickFormat(y_formatter);

function y_formatter(tick) {
    var ret = "";
    if (tick == 0) return ret;
    ret = d3.format(".0%")(Math.abs(tick));
    if (tick == 1) ret += " arbete";
    if (tick == -1) ret += " studier/fritid";
    return ret;
}

svg.append("defs").append("clipPath")
    .attr("id", "clip")
    .append("rect")
    .attr("width", width)
    .attr("height", height);

var focus = svg.append("g")
    .attr("class", "focus")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var context = svg.append("g")
    .attr("class", "context")
    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");


d3.queue()
    .defer(d3.json, "data/cv_stack.json")
    .defer(d3.json, "data/cv_descriptions.json")
    .await(drawTimeline);


function drawTimeline(error, stack, descriptions) {
    if (error) throw new Error("no data");
    var yyyy = d3.timeParse("%Y");
    var labels = [],
        _labels = {};

    var work = function() {
        var study_or_work = {};
        descriptions.forEach(o => {
            study_or_work[o.name] = o.type;
        });

        return {
            type: function(item) {
                return study_or_work[item.name ||  item.key];
            }
        }
    }();

    stack.forEach(year => {
        year["date"] = yyyy(year["date"]);

        // determine label x positions
        for (job in year) {
            if (job != "date") {
                if (!_labels[job]) {
                    _labels[job] = {};
                    _labels[job]["product"] = 0;
                    _labels[job]["weight"] = 0;
                    _labels[job]["top"] = 0;
                    _labels[job]["topyear"] = 0;
                }
                _labels[job]["product"] += year.date.getTime() * year[job];
                _labels[job]["weight"] += year[job];
                if (_labels[job]["top"] < year[job]) {
                    _labels[job]["top"] = year[job];
                }
            }
        }

        descriptions.forEach(description => {
            if (!year[description.name]) year[description.name] = 0.01;
        });

    });

    var dByName = d3.nest().key(o => o.name).rollup(o => o[0]).object(descriptions);

    for (_label in _labels) {
        let d,
            x = new Date(_labels[_label]["product"] / _labels[_label]["weight"]),
            y = _labels[_label]["top"];

        if (d = dByName[_label].label) {
            if (d.x) x = new Date(d.x);
            if (d.y) y = d.y;
        }

        labels.push({
            "x": x,
            "y": y,
            "name": _label
        });
    }

    var brush = d3.brushX()
        .extent([
            [0, 0],
            [width2, height2]
        ])
        .on("start brush end", brushed);

    var zoom = d3.zoom()
        .scaleExtent([1, 2])
        .translateExtent([
            [0, 0],
            [width2, height]
        ])
        .extent([
            [0, 0],
            [width2, height]
        ])
        .on("zoom", zoomed);

    function axis_callback() {
        // render x-axis as bar:
        var width = svg.attr("width");
        d3.select(".axis--x").select("path.domain").attr("d", "M0,0L0,28L" + (width) + ",28L+" + (width + 10) + ",14L" + width + ",0Z");

        // draw yearlines
        var yearlines = focus.selectAll("rect.yearline").data(x2.ticks(d3.timeYear, 1));
        var yearwidth = x(x.ticks(d3.timeYear, 1)[1]) - x(x.ticks(d3.timeYear, 1)[0]);
        yearlines.exit().remove();
        yearlines = yearlines.enter()
            .insert("rect", ":first-child")
            .attr("class", "yearline")
            .merge(yearlines);
        yearlines
            .style("fill", "url(#yearline)")
            .style("opacity", (o, i) => o.getYear() % 2 ? 1 : 0.8)
            .attr("x", o => x(o) - yearwidth)
            .attr("y", 0)
            .attr("width", yearwidth + 1)
            .attr("height", (o, i) => height - i * 5);
    }

    // Linedrawer – Timeline sets x() itself

    var workarea = d3.area()
        .curve(d3.curveCatmullRom)
        .x(function(d) {

            return x(d.data.date);
        })
        .y0(function(d) {
            return y(d[0]);
        })
        .y1(function(d) {
            return y(d[1]);
        });

    var studyarea = d3.area()
        .curve(d3.curveCatmullRom)
        .x(function(d) {
            return x(d.data.date);
        })
        .y0(function(d) {
            return y(-d[1]);
        })
        .y1(function(d) {
            return y(-d[0]);
        });

    x.domain([stack[0].date, d3.timeYear.offset(stack[stack.length - 1].date, 0)]);
    y.domain([-1.1, 1.1]);
    x2_to_x.domain(x2.range());
    x2.domain(x.domain());
    y2.domain(y.domain());

    var workkeys = descriptions.filter(o => o.type == "work").map(o => o.name);
    var studykeys = descriptions.filter(o => o.type == "study").map(o => o.name);
    var hobbykeys = descriptions.filter(o => o.type == "hobby").map(o => o.name);

    var abovedata = d3.stack().keys(workkeys).order(d3.stackOrderNone)(stack);
    var belowdata = d3.stack().keys(d3.merge([studykeys, hobbykeys])).order(d3.stackOrderNone)(stack);

    var workcolor = d3.scaleSequential(d3.interpolateOranges).domain([0, 10]);
    var studycolor = d3.scaleSequential(d3.interpolateBlues).domain([5, -5]);
    var hobbycolor = d3.scaleSequential(d3.interpolateGreys).domain([1, 8]);


    focus.append("g")
        .attr("transform", "translate(0,-10)")
        .selectAll("path")
        .data(abovedata)
        .enter()
        .each(function(o, i) {
            d3.select(this)
                .append("path")
                .attr("class", "stream workarea")
                .attr("fill", "url(#work_gradient_" + i + ")");
            d3.select(this)
                .append("defs")
                .append("linearGradient")
                .attr("id", "work_gradient_" + o.index)
                .attr("x1", 0).attr("x2", 0).attr("y1", 0).attr("y2", 1)
                .each(function(oo) {
                    d3.select(this).append("stop").attr("offset", "0%").attr("stop-color", workcolor(i));
                    d3.select(this).append("stop").attr("offset", "100%").attr("stop-color", workcolor(i - 2)).attr("stop-opacity", "0.5");
                })
        })

    focus.append("g")
        .attr("transform", "translate(0,10)")
        .selectAll("path")
        .data(belowdata)
        .enter()
        .each(function(o, i) {
            d3.select(this)
                .append("path")
                .attr("class", "stream " + work.type(o) + "area")
                .attr("fill", "url(#" + work.type(o) + "_gradient_" + i + ")");
            d3.select(this)
                .append("defs")
                .append("linearGradient")
                .attr("id", work.type(o) + "_gradient_" + o.index)
                .attr("x1", 0).attr("x2", 0).attr("y1", 0).attr("y2", 1)
                .each(function(oo) {
                    if (work.type(oo) == "study") {
                        d3.select(this).append("stop").attr("offset", "0%").attr("stop-color", studycolor(i - 2)).attr("stop-opacity", "0.5");
                        d3.select(this).append("stop").attr("offset", "100%").attr("stop-color", studycolor(i));
                    } else {
                        d3.select(this).append("stop").attr("offset", "0%").attr("stop-color", hobbycolor(i - 2)).attr("stop-opacity", "0.5");
                        d3.select(this).append("stop").attr("offset", "100%").attr("stop-color", hobbycolor(i));
                    }
                })
        })

    // focus.selectAll(".stream")
    //     .on("mouseover", function(d, i) {
    //     	d3.select(this).style("fill", "white");

    //     })
    //     .on("mouseout", function(d, i) {
    //         svg.selectAll(".layer")
    //             .transition()
    //             .duration(250)
    //             .attr("opacity", "1");
    //         d3.select(this)
    //             .classed("hover", false)
    //             .attr("stroke-width", "0px"), indicator.style("visibility", "hidden");
    //     })


    //                                                ,,
    //                                                db

    //                                      ,pP"Ybd `7MM  `7MMpMMMb.pMMMb.
    //                                      8I   `"   MM    MM    MM    MM
    //                                      `YMMMa.   MM    MM    MM    MM
    //                                      L.   I8   MM    MM    MM    MM
    //                                      M9mmmP' .JMML..JMML  JMML  JMML.

    var wrap = d3.textwrap().bounds({
        height: 100,
        width: 130
    }) /*.method('tspans')*/ ;

    function fitHeight(string) {
        return string.length / 4 + 3.5;
    }

    var events = [];
    descriptions.forEach(o => {
        if (o.events) o.events.forEach(event => {
            event.originalDate = new Date(event.date);
            event.date = x2(new Date(event.date));
            event.type = o.type;
            event.height = fitHeight(event.description);
            events.push(event);
        });
    });

    var shadows = d3.range(events.length).map((o, i) => {
        return {
            "type": events[i].type
        }
    });

    var nodes = d3.merge([events, shadows]);

    var links = [];
    for (let i = 0; i < nodes.length / 2; i++) {
        links.push({
            source: nodes[i],
            target: nodes[i + nodes.length / 2]
        })
    }
        var force = {
            force: 20,
            collide: 0.1,
            y: 0.1,
            x: 0.45
        };
    

    // var force = {
    //     force: -148,
    //     collide: 0.03,
    //     x: 0.9,
    //     y: 0.18
    // };

    var simulation = d3.forceSimulation(events)
        .force("force", d3.forceManyBody().strength(force.force))
        .force("collide", d3.bboxCollide(o => {
            let ret = [
                [-133 / 2, -o.height],
                [133 / 2, o.height]
            ];
            return ret;
        }).strength(force.collide).iterations(0.1))
        .force("y", d3.forceY(o => o.type == "work" ? y(1.5) : y(-1.5)).strength(0.1).strength(force.y))
        .force("x", d3.forceX(o => {
            let x = x2_to_x(o.date);
            if (x >= bodyrect.width - 150) return x - 150;
            if (x < 100) return x + 100;
            return x;
        }).strength(force.x))
        .on("tick", tick);

    simulation.nodes().forEach((o, i) => {
        o.y = y(0);
        o.x = x2_to_x(o.date);
    })

    var g_events = focus.selectAll("g.events").data(events);
    g_events = g_events.enter().append("g").attr("class", "event")
    .filter(n => n.weight >= 3)
        .each(function(o) {
        d3.select(this).append("path");
        d3.select(this).append("text")
            .text(o.description).call(wrap);
        d3.select(this).append("circle").attr("class", "lineend").attr("r", 2).style("fill", "#444");

        if (true) {
            d3.select(this).insert("circle", ":first-child").attr("class", "target").attr("r", 3).style("fill", "red").style("opacity", "0.1");
        }
    });

    var labelline = d3.line().curve(d3.curveStepBefore.radius(6));

    function tick() {



    	
        g_events.selectAll("path").attr("d", o => {
            var pt;

            if (x2_to_x(o.date) > x2_to_x(o.x) + 133 / 2) {
                pt = [
                    [x2_to_x(o.x) + 133 / 2, (o.y - 5)],
                    [x2_to_x(o.date), y(0) - 14]
                ];
            } else if (x2_to_x(o.date) < x2_to_x(o.x) - 133 / 2) {
                pt = [
                    [x2_to_x(o.x) - 133 / 2, (o.y - 5)],
                    [x2_to_x(o.date), y(0) - 14]
                ];
            } else {
                if (o.type == "work") {
                    pt = [
                        [x2_to_x(o.date), (o.y + fitHeight(o.description))],
                        [x2_to_x(o.date), y(0) - 14]
                    ];
                } else {
                    pt = [
                        [x2_to_x(o.date), (o.y - 15)],
                        [x2_to_x(o.date), y(0) - 14]
                    ];

                }
            }
            return labelline(pt);
        });

        g_events.selectAll(wrap.method() == "foreignobject" ? "foreignObject" : "text")
            .attr("transform", function(o) {
                var ret = "translate(";
                ret += x2_to_x(o.x) - 133 / 2;
                ret += "," + (o.y - fitHeight(o.description)) + ")";
                return ret;
            })
            .attr("text-anchor", (o) => {
                return (x2_to_x(o.date) < x2_to_x(o.x)) ? "start" : "end";
            })
            .style("text-align", (o) => {
                return (x2_to_x(o.date) < x2_to_x(o.x)) ? "left" : "right";
            })
            .select("tspan").attr("dx", o => {
                return (o.date < o.x) ? "5" : "-5";
            })
            // g_events.selectAll("circle.target").attr("cx", o => x2_to_x(o.target.x)).attr("cy", o => o.target.y);
        // g_events.selectAll("circle.lineend").attr("cx", o => x2_to_x(o.x)).attr("cy", o => o.y - 5).style("fill");
    }



    //   ,,           ,,                  ,,
    // `7MM          *MM                `7MM
    //   MM           MM                  MM
    //   MM   ,6"Yb.  MM,dMMb.   .gP"Ya   MM  ,pP"Ybd
    //   MM  8)   MM  MM    `Mb ,M'   Yb  MM  8I   `"
    //   MM   ,pm9MM  MM     M8 8M""""""  MM  `YMMMa.
    //   MM  8M   MM  MM.   ,M9 YM.    ,  MM  L.   I8
    // .JMML.`Moo9^Yo.P^YbmdP'   `Mbmmd'.JMML.M9mmmP'


    focus.selectAll("g.label")
        .data(labels)
        .enter()
        .append("g")
        .attr("class", o => "label " + work.type(o) + "label")
        .append("text")
        .attr("y", o => {
            var sign = work.type(o) == "work" ? 1 : -1;
            return y(sign * Math.sqrt(o.y) / 1.4) + 15;
        })
        .text(o => o.name)
        .each(rectify);

    function rectify(d, i) {
        var labelmargin = 4;
        var parent = d3.select(this.parentNode);
        var box = this.getBBox();
        box.x += d3.select(this).attr("x");

        parent.insert("rect", ":first-child")
            .attr("x", box.x - labelmargin)
            .attr("y", box.y)
            .attr("rx", 3)
            .attr("ry", 3)
            .attr("width", box.width + 2 * labelmargin)
            .attr("height", box.height)
    }

    // draw now
    focus.selectAll("g.now").data([new Date()]).enter()
        .append("g")
        .each(function(o) {
            d3.select(this).append("path").attr("class", "nowpath");
            d3.select(this).append("g")
                .attr("class", "now")
                .append("text")
                .attr("class", "nowlabel")
                .attr("text-anchor", "middle")
                .text("now").each(rectify);
        });




    //                       ,,
    //                       db

    //  ,6"Yb.  `7M'   `MF'`7MM  ,pP"Ybd
    // 8)   MM    `VA ,V'    MM  8I   `"
    //  ,pm9MM      XMX      MM  `YMMMa.
    // 8M   MM    ,V' VA.    MM  L.   I8
    // `Moo9^Yo..AM.   .MA..JMML.M9mmmP'



    focus.append("g")
        .attr("class", "axis axis--x focus")
        .attr("transform", "translate(0," + (y(0) - 14) + ")")
        .style("filter", "url(#dropshadow)")
        .call(xAxis);

    focus.append("g")
        .attr("class", "axis axis--y")
        .call(yAxis);

    context.append("g")
        .attr("class", "axis axis--x context")
        .attr("transform", "translate(0," + height2 + ")")
        //        .call(xAxis2);

    context.append("g")
        .attr("class", "brush");

    svg.append("rect")
        .attr("class", "zoom")
        .attr("width", width)
        .attr("height", height)
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .call(zoom);

    context.call(brush);

    var handle = context.selectAll(".handle--custom")
        //     .data([{
        //         type: "w"
        //     }, {
        //         type: "e"
        //     }])
        //     .enter().append("path")
        //     .attr("class", "handle--custom")
        //     .attr("fill", "url(#lgrad)")
        //     .attr("fill-opacity", 0.3)
        //     .attr("cursor", "ew-resize")
        //     .attr("d", d3.arc()
        //         .innerRadius(0)
        //         .outerRadius(height2 / 2)
        //         .startAngle(0)
        //         .endAngle(function(d, i) {
        //             return i ? Math.PI : -Math.PI;
        //         }));

    context.call(brush.move, startRange);
    // d3.select("rect.selection").style("fill", "url(#lgrad)");
    context.style("opacity", "0.2");



    function brushed() {
        if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
        var s = d3.event.selection || x2.range();

        handle.attr("display", null).attr("transform", function(d, i) {
            return "translate(" + s[i] + "," + height2 / 2 + ")";
        });

        x.domain(s.map(x2.invert, x2));
        x2_to_x.domain(s);

        focus.select(".axis--x").call(xAxis);
        svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
            .scale(width2 / (s[1] - s[0]))
            .translate(-s[0], 0));

        focus.selectAll(".workarea").attr("d", workarea);
        focus.selectAll(".studyarea").attr("d", studyarea);
        focus.selectAll(".hobbyarea").attr("d", studyarea);
        focus.selectAll(".label").attr("transform", o => "translate(" + x(o.x) + ")");
        focus.select(".nowpath").attr("d", o => "M" + x(o) + "," + y(0) + "L" + x(o) + "," + y(-0.7))
        focus.select(".now").attr("transform", o => "translate(" + x(o) + "," + y(-0.7) + ")");
        // fix x-axis into bar:
        axis_callback();
        tick();
        simulation.alpha(1);
        simulation.restart();
    }

    function zoomed() {
        if (d3.event.sourceEvent && d3.event.sourceEvent.type === "brush") return; // ignore zoom-by-brush
        var t = d3.event.transform;
        x.domain(t.rescaleX(x2).domain());
        x2_to_x.domain(x2.range().map(t.invertX, t));

        focus.select(".axis--x").call(xAxis);
        context.call(brush.move, x2.range().map(t.invertX, t));
        focus.selectAll(".workarea").attr("d", workarea);
        focus.selectAll(".studyarea").attr("d", studyarea);
        focus.selectAll(".hobbyarea").attr("d", studyarea);
        focus.selectAll(".label").attr("transform", o => "translate(" + x(o.x) + ")");

        // fix x-axis into bar:
        axis_callback();
        tick();
        simulation.alpha(1);
        simulation.restart();
    }

    //        ,,                                           ,,
    //      `7MM           mm                              db
    //        MM           MM
    //   ,M""bMM   ,6"Yb.mmMMmm     .P"Ybmmm `7MM  `7MM  `7MM
    // ,AP    MM  8)   MM  MM      :MI  I8     MM    MM    MM
    // 8MI    MM   ,pm9MM  MM       WmmmP"     MM    MM    MM
    // `Mb    MM  8M   MM  MM   ,, 8M          MM    MM    MM
    //  `Wbmd"MML.`Moo9^Yo.`Mbmodb  YMMMMMb    `Mbod"YML..JMML.
    //                             6'     dP
    //                             Ybmmmd'

    var guivars = function()  {
        this.force = force.force;
        this.collide = force.collide;
        this.x = force.x;
        this.y = force.y;
    }

    function GUICHANGE(change) {
        simulation.force(this.property).strength(change);
        simulation.alpha(1);
        simulation.restart();
    }
    text = new guivars();
    var gui = new dat.GUI();
    gui.add(text, "force", -200, 200).onChange(GUICHANGE);
    gui.add(text, "collide", 0, 1).onChange(GUICHANGE);
    gui.add(text, "x", 0, 1).onChange(GUICHANGE);
    gui.add(text, "y", 0, 1).onChange(GUICHANGE);

}
</script>
